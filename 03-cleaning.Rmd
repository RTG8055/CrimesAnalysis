# Data transformation

```{r}
library("naniar")
library("ggplot2")
library("dplyr")
library("tidyr")
library("lubridate")
library("ggpubr")
library("data.table")
```

## New York City Population

Since we intend to use this data to calculate the percentage of people being shot in each borough based on the borough's population, we will filter only the years for which we have corresponding shooting data.

```{r}

class(df_population_yearly$Year)

df_population_2010<-df_population_yearly %>%
  filter(Year==2010) %>%
  group_by(Borough) %>%
  summarize(population=sum(Population))

df_population_2020<-df_population_age %>%
  select(Borough, Age, "2020")
```

## Shootings in NYC

### Pre-processing Data


```{r, echo=FALSE}

# df_shooting_ytd <- readr::read_csv("datasets/NYPD_Shooting_Incident_Data__Year_To_Date_.csv")
# df_shooting_old <- readr::read_csv("https://data.cityofnewyork.us/resource/833y-fsy8.csv")
```


```{r, echo=TRUE}
colnames(df_shooting_old)<- toupper(colnames(df_shooting_old))
colnames(df_shooting_ytd)<- toupper(colnames(df_shooting_ytd))
```

 - Column names in the old and new data have different case, converting to a common format for merging the 2 later.

```{r}
df_shooting_ytd$OCCUR_DATE <-as.Date(df_shooting_ytd$OCCUR_DATE, format = "%m/%d/%Y")
df_shooting_old$OCCUR_DATE <-as.Date(df_shooting_old$OCCUR_DATE, format = "%m/%d/%Y")

df_shooting_total<-bind_rows(df_shooting_ytd, df_shooting_old)
df_shooting_total$OCCUR_DATE <-as.Date(df_shooting_total$OCCUR_DATE, format = "%m/%d/%Y")
```

 - Converting the date columns in both to date class using format and then merging the 2 datasets in one.
 
### Feature Engineering

 - creating more features from the existing features to help 

```{r, echo=TRUE}
# extract year and month from date - #TODO: hour and dayofweek
df_shooting_total<-df_shooting_total %>%
  mutate(year = year(OCCUR_DATE), month = lubridate::month(OCCUR_DATE,label = TRUE), day = lubridate::wday(OCCUR_DATE,label = TRUE),
         murder = ifelse(STATISTICAL_MURDER_FLAG==TRUE, 1, 0))
```
 
  - Extracted year, month, day of the week and hour of shooting
  - #TODO!!!!!!!!!!!!!!!!!!!
  - Calculated Percentage change in number of shootings every month.

