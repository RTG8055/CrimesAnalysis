# Results

## Shootings in NYC

### Monthly Trend in number of shootings

#### Whole NYC

```{r}
covid_date<- as.Date("2020-04-01", format = "%Y-%m-%d")

df_shoot_grouped_NYC <- df_shooting_total %>%
  select(year, month, STATISTICAL_MURDER_FLAG, VIC_AGE_GROUP, VIC_SEX, VIC_RACE) %>%
  group_by(year, month, STATISTICAL_MURDER_FLAG, VIC_SEX, VIC_AGE_GROUP, VIC_RACE) %>%
  summarize(occurances = n())

df_shoot_grouped_NYC$date<-as.Date(paste(df_shoot_grouped_NYC$year, df_shoot_grouped_NYC$month,"1",sep="-"), format = "%Y-%b-%d")

df_shoot_grouped_BORO <- df_shooting_total %>%
  select(year, month, BORO, murder, VIC_AGE_GROUP, VIC_SEX, VIC_RACE) %>%
  group_by(year, month, murder, BORO, VIC_SEX, VIC_AGE_GROUP, VIC_RACE) %>%
  summarize(occurances = n())

df_shoot_grouped_BORO$BORO <- as.factor(df_shoot_grouped_BORO$BORO)

df_shoot_grouped_BORO$date<-as.Date(paste(df_shoot_grouped_BORO$year, df_shoot_grouped_BORO$month,"1",sep="-"), format = "%Y-%b-%d")

df_shoot_grouped_week <- df_shooting_total %>%
  select(OCCUR_DATE, day, STATISTICAL_MURDER_FLAG, VIC_AGE_GROUP, VIC_SEX, VIC_RACE) %>%
  group_by(OCCUR_DATE, day, STATISTICAL_MURDER_FLAG, VIC_SEX, VIC_AGE_GROUP, VIC_RACE) %>%
  summarize(occurances = n())

# df_shoot_grouped_week$date<-as.Date(paste(df_shoot_grouped_Week$year, df_shoot_grouped_Week$month,"1",sep="-"), format = "%Y-%b-%d")


```

```{r, fig.width=10,fig.height=11}
temp_df<- df_shoot_grouped_NYC %>% 
  filter(year>=2019) %>%
  group_by(date, month) %>%
  summarize(total_shots= sum(occurances))#%>%
  # mutate(monthly_change = (total_shots/shift(total_shots, n=1, fill = NA, type="lag") -1)*100)

temp_df$monthly_change<- ((temp_df$total_shots/shift(temp_df$total_shots, n=1, fill=NA, type="lag"))-1)

ggplot(temp_df, aes(x= date)) + 
  geom_bar(aes(y = monthly_change, fill = factor(month)), stat="identity") +
  geom_text(aes( label = scales::percent(monthly_change),
                  y= monthly_change ), stat= "identity",angle = 90) +
  scale_y_continuous(labels = scales::percent) +
  ggtitle("Is it that time of the year?!",
          subtitle = "Percentage change in number of Shootings by month") +
  labs(y = "Percentage Change", x="Date", fill="Month", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68")) +geom_vline(xintercept = covid_date, linetype="dashed", color = "blue")
```

 - We see every year in the month of May and June the number of shootings rise.
 - Last year, (possibly due to covid restrictions easing up) saw 92-95% increase in these months.

#### Borough wise

```{r, fig.width=10,fig.height=11}
temp_df<- df_shoot_grouped_BORO %>% 
  filter(year>=2019) %>%
  group_by(date, month) %>%
  summarize(total_shots= sum(occurances))#%>%
  # mutate(monthly_change = (total_shots/shift(total_shots, n=1, fill = NA, type="lag") -1)*100)

temp_df$monthly_change<- ((temp_df$total_shots/shift(temp_df$total_shots, n=1, fill=NA, type="lag"))-1)

ggplot(temp_df, aes(x= date)) + 
  geom_bar(aes(y = monthly_change, fill = factor(month)), stat="identity") +
  geom_text(aes( label = scales::percent(monthly_change),
                  y= monthly_change ), stat= "identity",angle = 90) +
  scale_y_continuous(labels = scales::percent) +
  ggtitle("Is it that time of the year?!",
          subtitle = "Percentage change in number of Shootings by month") +
  labs(y = "Percentage Change", x="Date", fill="Month", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68")) +geom_vline(xintercept = covid_date, linetype="dashed", color = "blue")
```

### Weekly Trend in number of shooting

```{r}
temp_df<- df_shoot_grouped_week %>% 
  group_by(day) %>%
  summarize(total_shots= mean(occurances))#%>%
  # mutate(monthly_change = (total_shots/shift(total_shots, n=1, fill = NA, type="lag") -1)*100)

temp_df$weekly_change<- ((temp_df$total_shots/shift(temp_df$total_shots, n=1, fill=NA, type="lag"))-1)

ggplot(temp_df, aes(x= day, y = total_shots, fill = factor(day), label=sprintf("%0.2f", round(total_shots, digits = 2)))) + 
  geom_bar(stat="identity") +
  geom_text( vjust=-.5) +
  ggtitle("Does the day of the week matter?!",
          subtitle = "Average number of shootings on the day of the week") +
  labs(y = "Average shooting count", x="Day", fill="Weekday", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```

 - This graph shows that irrespective of the day of the week it is almost equally like for a shooting to be there.

### Trend in number of deaths

  - Plotted monthly change and daily change graphs to identify the number of shootings leading to deaths are mainly erratic and do not follow a said pattern.

### Susciptible groups

#### Victim Age

```{r}
temp_df<- df_shoot_grouped_BORO %>% 
  filter(year>=2019, VIC_AGE_GROUP!="UNKNOWN") %>%
  group_by(date,BORO, VIC_AGE_GROUP) %>%
  summarize(total_shots= sum(occurances)) %>%
  ungroup()

temp_df$BORO <- as.factor(temp_df$BORO)

theme_heat <- theme_classic() +
  theme(axis.line = element_blank(),
        axis.ticks = element_blank())
```

```{r, fig.width=10,fig.height=11}
ggplot(temp_df, aes(x = date, y = VIC_AGE_GROUP)) +
  geom_tile(aes(fill = total_shots), color = "black") +
  theme_heat + ggtitle("Does age matter?!",
                       subtitle = "Number of Shootings in each borough for each age group by month") + scale_fill_gradient(low = "#cccccc", high = "#880808") +
  facet_grid(BORO~.) +
  labs(y = "Borough", x="Date", fill="Number of shootings", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```

 - There are multiple deductions from the above graph:
   - The most widely affected age group is the 25-44 age group.
   - Brooklyn and Bronx have the highest shootings.

### Gender

```{r}

temp_df<- df_shoot_grouped_BORO %>% 
  filter(year>=2019, VIC_SEX!="U") %>%
  group_by(date,BORO, VIC_SEX) %>%
  summarize(total_shots= sum(occurances)) %>%
  ungroup()

ggplot(temp_df, aes(x = date, color = BORO, y = total_shots)) +
  geom_line() +
  ggtitle("Males and Females across NYC",
                       subtitle = "Number of Shootings in each borough by gender over time") + scale_fill_gradient(low = "#cccccc", high = "#880808") +
  labs(y = "Number of shootings", x="Date", color="Borough", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme_pubr(legend="right") + facet_grid(VIC_SEX~., scales = "free", space="free_x") + 
  geom_vline(xintercept = covid_date, linetype="dashed", color = "blue")
```
  
 - The data on number fo female victims in shootings is less but among them, brooklyn has the highest in the past 2 years.
 - In general, we see a clear increase in the number of shootings post covid (blue-line)

### Hot-spot neighbourhoods/AREAS 

#### Number of shootings in different borough every month

```{r}
temp_df<- df_shoot_grouped_BORO %>% 
  filter(year>=2019) %>%
  group_by(date,BORO) %>%
  summarize(total_shots= sum(occurances)) %>%
  ungroup()

temp_df$BORO <- as.factor(temp_df$BORO)

theme_heat <- theme_classic() +
  theme(axis.line = element_blank(),
        axis.ticks = element_blank())

ggplot(temp_df, aes(x = date, y = BORO)) +
  geom_tile(aes(fill = total_shots), color = "black") +
  theme_heat + ggtitle("Where to stay?!",
                       subtitle = "Number of Shootings in each borough by month") + scale_fill_gradient(low = "#cccccc", high = "#880808") +
  labs(y = "Borough", x="Date", fill="Number of shootings", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))
```

 - This graph tells us, staten island is at an all time low in the number of shootings, relatively.
 - Also, Brooklyn and Bronx have the most number of shootings which peaked duing the month of july in 2020.

#### Percentage Change in the off shootings in different boroughs

```{r}
temp_df<- df_shoot_grouped_BORO %>% 
  filter(year>=2019) %>%
  group_by(BORO,date) %>%
  summarize(total_shots= sum(occurances)) %>%
  mutate(monthly_change = (total_shots/shift(total_shots, n=1, fill = NA, type="lag") -1)/10)

temp_df$month<- lubridate::month(temp_df$date,label = TRUE)
```

```{r}
ggplot(temp_df, aes(x= date)) + 
  geom_bar(aes(y = monthly_change, fill = factor(month)), stat="identity") +
  # geom_text(aes( label = scales::percent(monthly_change),
                 # y= monthly_change ), stat= "identity",angle = 90) +
  facet_grid(BORO~.) +
  scale_y_continuous(labels = scales::percent)+
  ggtitle("Where to visit and When?!",
          subtitle = "Percentage change in number of Shootings in borough by month") +
  labs(y = "Percentage Change", x="Date", fill="Month", caption = "Source: NYC-open-Data::Shooting Incident Data") +
  theme(plot.title = element_text(face = "bold")) +
  theme(plot.subtitle = element_text(face = "bold", color = "grey35")) +
  theme(plot.caption = element_text(color = "grey68"))

```
 - This faceted graph gives us a deeper dive in just the numbers to explain that even though total number of shootings has been at an all time high in Brooklyn and Bronx, The recent numbers have started to decrease. can be due to active action taken by authorities or better awareness.
 - Also, in case of Staten island, the behavior is very erratic, hinting at a more loose control than other boroughs.

### geo map

```{r}
library(tidyverse)
library(ggplot2)
library(mi)

#df_fbi_ht <- readr::read_csv("datasets/HT_2013_2019.csv")

# fbiHT_df <- as.data.frame(df_fbi_ht)

# summary(df_fbi_ht)

theme_dotplot <- theme_bw(14) +
  theme(axis.text.y = element_text(size = rel(.75)),
        axis.ticks.y = element_blank(),
        axis.title.x = element_text(size = rel(.75)),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(size = 0.5),
        panel.grid.minor.x = element_blank())
```

## Human Trafficking

```{r}
df_fbi_ht_temp <- df_fbi_ht %>%
  group_by(STATE_NAME) %>%
  summarise(Total = n())

ggplot(df_fbi_ht_temp, aes(x = Total, y = reorder(STATE_NAME, Total))) +
  geom_point(color = "blue") +
  theme_dotplot +
  xlab("Total registered cases") +
  ylab("State") +
  ggtitle("Registered Human Trafficking cases by State (2013-19)")
```

## Hate Crimes 

```{r}
hate3 <- ggplot(data=df_hate, aes(x=County, fill=factor(Complaint.Year.Number))) + geom_bar(data=df_hate)
hate3
```

#### Insights
Kings County (Brooklyn) had the highest total number of hate crimes over the years 2019 and 2020. This was followed by New York (Manhattan) and then Queens. 

The only county/borough to have experienced an upturn in hate crimes in 2020  was the Richmond county (Staten Island Borough). 

This is confirmed by articles such as (Source: silive.com https://www.silive.com/crime-safety/2021/04/staten-island-was-the-only-borough-in-nyc-with-an-increase-in-hate-crimes-in-2020-why-where-were-they-crime-analysis.html)


```{r}
library(ggplot2)
df_hate <- read.csv("datasets/NYPD_Hate_Crimes.csv")
hate1 <- ggplot(data=df_hate, aes(y=Offense.Category, fill=County)) + geom_bar(data=df_hate, alpha=0.9, position = position_stack(reverse = TRUE))
hate1
```

#### Insights 
The largest proportion of hate crimes stem from religious reasons, followed by race and sexual orientation. 

Kings County (Brooklyn) has a much larger proportion of these religious crimes. Interestingly, although the total number of hate crimes is greater in Kings County (Brooklyn) than New York County (Manhattan), the number of crimes stemming from Sexual Orientation and Race/Color is greater in New York County than Kings County. 

```{r}
theme_dotplot <- theme_bw(14) +
    theme(axis.text.y = element_text(size = rel(.5)),
        axis.ticks.y = element_blank(),
        axis.title.x = element_text(size = rel(.75)),
        panel.grid.major.x = element_blank(),
        panel.grid.major.y = element_line(size = 1),
        panel.grid.minor.x = element_blank())

df_temp <- as.data.frame(table(df_hate$Bias.Motive.Description))
#View(df_temp)
hate2 <- ggplot(df_temp, aes(x = Freq, 
               y = reorder(Var1, Freq))) +
    geom_point(color = "blue") +
    theme_dotplot +
    xlab("Incident Count") +
    ylab("Motive Type") +
    ggtitle("Motive Type Counts")
hate2
```

#### Insights

Anti- Jewish hate crimes seem to be the largest in number (by a large amount, almost 350 crimes) during this time period, followed by anti-homosexual (gay) and anti-black crimes. 

```{r}
hate4 <- ggplot(data=df_hate, aes(y=Bias.Motive.Description, fill=County)) + geom_bar(data=df_hate, alpha=0.9, position = position_stack(reverse = TRUE))
hate4
```

#### Insights

As expected from the previous 2 graphs, Kings County (Brooklyn) has the highest number of anti-jewish crimes. Kings County has a disproportionately large number of these crimes, whereas other motive types like anti-black or anti-homosexual seem to be equal in the boroughs of Kings and New York (Manhattan).

These insights are confirmed by articles such as (https://www.cbsnews.com/news/nypd-to-increase-presence-in-brooklyn-after-string-of-anti-semitic-hate-crimes/ Source: CBS News)


```{r}
df_hate$Complaint.Year.Number <- as.factor(df_hate$Complaint.Year.Number)
hate5 <- ggplot(data=df_hate, aes(x=Complaint.Year.Number, fill=Offense.Category)) + geom_bar(data=df_hate)
hate5
```

#### Insights
Across the city of New York, the number of hate crimes went down in 2020 (by almost 40%). Sexual orientation crimes decreased, whereas crimes based on race/color unfortunately went up in number. 

```{r}
df_temp <- as.data.frame(table(df_hate$Month.Number, df_hate$Complaint.Year.Number))

df_temp$new_col <- c(12:1)
#View(df_temp)
hate6 <- ggplot(df_temp, aes(x = Freq, 
               y = reorder(Var1, new_col), color=Var2)) +
    geom_point() +
    theme_dotplot +
    xlab("Incident Count") +
    ylab("Month Number") +
    ggtitle("Incident Counts by month")
hate6
```

#### Insights
Across both years, it is visible that there is a dependance on the month when it comes to the number of crimes. 

However, for all months, 2020 had lower number of hate crimes than there were in 2019. The highest crime number for both years was in the month of March. 

```{r}
library(vcd)
hate7 <- vcd::doubledecker(Bias.Motive.Description ~ Complaint.Year.Number + County, data=df_hate, main='Analysing Motive with year and county') 
```

#### Insights

The insights from this mosaic plot corroborate our findings from the previous plots. 

```{r}
df_hate$date_diff <- as.Date(as.character(df_hate$Arrest.Date), format="%m/%d/%Y")-
                  as.Date(as.character(df_hate$Record.Create.Date), format="%m/%d/%Y")
hate8 <- ggplot(data=df_hate, mapping=aes(x=date_diff)) + geom_histogram( bins=20, color="#e9ecef", alpha=0.6, position = 'identity') + facet_wrap(~Complaint.Year.Number) #+ xlim(0,200)
hate8
```

#### Insights
The majority of arrests, if made, were made within 50 days since the report creation, for both the years 2019 and 2020. This indicates a heavy right-skew in the graphs. 

Only very few arrests were made beyond the 50-day mark in both years.

```{r}
hate9 <- ggplot(data=df_hate, aes(y=PD.Code.Description, fill=County)) + geom_bar(data=df_hate, alpha=0.9, position = position_stack(reverse = TRUE))
hate9
```


#### Insights
Criminal Mischief, Aggravated Assault and Aggravated Harrassment were the most code of hate crimes committed.


```{r}
x <- data.frame(table(df_hate$Arrest.Date))
length(x$Freq)
arr <- sum(x$Freq[c(2:length(x$Freq))])
narr <- x$Freq[1]
arrvec <- c(arr, narr)
labels1 <- c('Arrested', 'Not Arrested')
df <- data.frame(labs = labels1, outcome = arrvec)
ggplot() + geom_col(df, mapping = aes(labs, outcome))
```

#### Insights
Unfortunately, the majority of offenders in hate crimes during 2019 and 2020 have not been arrested. 

506 offenders were not arrested, whereas 222 arrests were made. 

This picture might be offset in the case of one person commited multiple hate crimes and then being arrested. As we do not have information regarding arrest details, such analysis is omitted here. 
